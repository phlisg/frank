#!/bin/bash

aliases=("composer" "artisan" "php" "psql" "npm")

echo "# Laravel Docker Environment Activation"
echo "# This script sets up aliases for Laravel development"
echo ""
echo "# Check if containers are running"
echo "if ! docker compose ps app | grep -q 'Up'; then"
echo "  echo '❌ Laravel containers are not running. Please run \"just up\" first.'"
echo "  return 1"
echo "fi"
echo ""
echo "# Set up aliases"
echo "alias composer='docker compose exec app composer'"
echo "alias artisan='docker compose exec app php artisan'"
echo "alias php='docker compose exec app php'"
echo "alias psql='docker compose exec db psql -U root -d $DB_DATABASE'"
echo "alias npm='docker compose exec app npm'"
echo ""
echo "# Set up environment variable to indicate activation"
echo "export LARAVEL_DOCKER_ENV_ACTIVE=1"
echo ""
echo "# Update prompt to show activation (optional)"
echo "if [[ -z \"$LARAVEL_DOCKER_ENV_ORIGINAL_PS1\" ]]; then"
echo "  export LARAVEL_DOCKER_ENV_ORIGINAL_PS1=\"$$PS1\""
echo "fi"
echo "export PS1=\"(laravel-docker) $LARAVEL_DOCKER_ENV_ORIGINAL_PS1\""
echo ""
echo "# Function to deactivate"
echo "deactivate() {"
for alias in "${aliases[@]}"; do
  echo "  unalias $alias 2>/dev/null || true"
done
echo "  if [[ -n \"$LARAVEL_DOCKER_ENV_ORIGINAL_PS1\" ]]; then"
echo "    export PS1=\"$LARAVEL_DOCKER_ENV_ORIGINAL_PS1\""
echo "    unset LARAVEL_DOCKER_ENV_ORIGINAL_PS1"
echo "  fi"
echo "  unset LARAVEL_DOCKER_ENV_ACTIVE"
echo "  unset -f deactivate"
echo "  echo '📦 Laravel Docker environment deactivated'"
echo "}"
echo ""
echo "echo ''; echo '🏕️ Laravel Docker environment activated!'"
echo "echo '📦 Available commands: ${aliases[*]}'"
echo "echo '🔧 To deactivate, run: deactivate'"